#include "resource.h"
#include <OmegaWTK.h>
#include <wrl.h>
#include <debugapi.h>

#pragma comment(lib, "runtimeobject.lib")

#define MAX_LOADSTRING 100

// LPCSTR szTitle = "@APPNAME@";                
// LPCSTR szWindowClass = "@APPNAME@"; 

int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance,  PSTR lpCmdLine, int nShowCmd){

    // MessageBoxA(HWND_DESKTOP,"LoadingApp","NOTE",MB_OK);
    HRESULT hr;
    hr = CoInitializeEx(NULL,COINIT_MULTITHREADED);
    if(!SUCCEEDED(hr))
    {
        //Handle Error!
    }
   
    void *factory = create_hwnd_factory((void *)hInstance);
    OmegaWTK::AppInst *appInst = new OmegaWTK::AppInst();
   
   
    omegaWTKMain(appInst);

    HACCEL hAccelTable = LoadAccelerators(hInstance,MAKEINTRESOURCE(IDC_@APPNAME@));
    BOOL breturn;

    MSG msg = {};
    while (GetMessage(&msg,nullptr,0,0))
    {
        if (!TranslateAccelerator(msg.hwnd, hAccelTable, &msg))
        {
            TranslateMessage(&msg);
            DispatchMessage(&msg);
        }
    }

    free_hwnd_factory(factory);

    CoUninitialize();

    delete appInst;

    return msg.wParam;

};